[
["index.html", "Статистика, R и анализ данных 1 Дисклеймер", " Статистика, R и анализ данных Ануфриев Григорий 2020-02-25 1 Дисклеймер Тут находятся конспекты занятий, задания и другие материалы к лекциям AnDan под эгидой UX Lab. Сайт сделан с помощью RMarkdown, все исходные .RMD файлы лежат на гитхабе. Множество материалов в лекции вдохновлено и просто взято из различных источников, например этого чудестного курса по R: https://stepik.org/course/129/syllabus "],
["chastoty.html", "2 Частотные данные и таблицы сопряженности 2.1 Темы занятия 2.2 Частотные данные 2.3 Частотный анализ для разных шкал измерений 2.4 Построение таблиц сопряженности.", " 2 Частотные данные и таблицы сопряженности 2.1 Темы занятия Частотные данные Описательные статистики Частотный анализ для разных шкал измерений Показатели вариации Таблицы сопряженности 2.2 Частотные данные Частотные данные часто используются для описательных статистик. Это позволяет получить представление о структуре анализируемых данных в целом. Примеры будем разбирать на встроенном датасете R - mtcars: датасет с 32 автомобилями по 11 признакам, два из которых (vs и am) являются номинальными переменными (факторами) c уровнями, закодированными в виде 0 и 1 (подробнее см. ?mtcars). mpg - топлевная экономичность (в милях на галон) запишем его в переменнную df. df &lt;- mtcars 2.2.1 Описательные статистики К описательным статистикам обычно относят характеристики центральной тенденции: Медиана - уровень показателя, который делит набор данных на две равные половины. median(df$mpg) ## [1] 19.2 Арифметическое среднее - сумма чисел, разделённая на их количество. mean(df$mpg) ## [1] 20.09062 Мода - значение во множестве наблюдений, которое встречается наиболее часто. Для моды стандартной команды в R не предусмотрено, можно использовать такую функцию: Modes &lt;- function(x) { ux &lt;- unique(x) # выделение уникальных значений в векторе tab &lt;- tabulate(match(x, ux)) # подсчет сколько раз встречается значение ux[tab == max(tab)] } Modes(df$cyl) ## [1] 8 также к К описательным статистикам относят показатели вариации (изменчивости) данных: Дисперсия случайной величины – это один из основных показателей в статистике. Он отражает меру разброса данных вокруг арифметической средней. var(df$mpg) ## [1] 36.3241 Стандартное отклонение - оценка стандартного отклонения ее выборочного распределения, приближенно показывает, насколько значение статистики может отличаться от своего среднего значения (параметра генеральной совокупности). sd(df$mpg) ## [1] 6.026948 Стандартная ошибка - (или просто стандартная ошибка) приближенно показывает, насколько ее выборочная средняя (случайная наблюдаемая величина) отличается от среднего генеральной совокупности. Специальной функции для расчета стандартной ошибки среднего в R нет, однако для этого вполне подойдут уже имеющиеся функции. Как известно, стандартная ошибка средней рассчитывается как отношение стандартного отклонения (sd) к квадратному корню из объема выборки: sd(df$mpg)/sqrt(length(df$mpg)) # функция length() возвращает число элементов в векторе mpg ## [1] 1.065424 Минимальное, максимальное значение и размах (оба значения). min(df$mpg) ## [1] 10.4 max(df$mpg) ## [1] 33.9 range(df$mpg) ## [1] 10.4 33.9 Можно посмотреть многие эти характеристики (если они применимы к шкале) с помощью функции summary(). summary(df) ## mpg cyl disp hp ## Min. :10.40 Min. :4.000 Min. : 71.1 Min. : 52.0 ## 1st Qu.:15.43 1st Qu.:4.000 1st Qu.:120.8 1st Qu.: 96.5 ## Median :19.20 Median :6.000 Median :196.3 Median :123.0 ## Mean :20.09 Mean :6.188 Mean :230.7 Mean :146.7 ## 3rd Qu.:22.80 3rd Qu.:8.000 3rd Qu.:326.0 3rd Qu.:180.0 ## Max. :33.90 Max. :8.000 Max. :472.0 Max. :335.0 ## drat wt qsec vs ## Min. :2.760 Min. :1.513 Min. :14.50 Min. :0.0000 ## 1st Qu.:3.080 1st Qu.:2.581 1st Qu.:16.89 1st Qu.:0.0000 ## Median :3.695 Median :3.325 Median :17.71 Median :0.0000 ## Mean :3.597 Mean :3.217 Mean :17.85 Mean :0.4375 ## 3rd Qu.:3.920 3rd Qu.:3.610 3rd Qu.:18.90 3rd Qu.:1.0000 ## Max. :4.930 Max. :5.424 Max. :22.90 Max. :1.0000 ## am gear carb ## Min. :0.0000 Min. :3.000 Min. :1.000 ## 1st Qu.:0.0000 1st Qu.:3.000 1st Qu.:2.000 ## Median :0.0000 Median :4.000 Median :2.000 ## Mean :0.4062 Mean :3.688 Mean :2.812 ## 3rd Qu.:1.0000 3rd Qu.:4.000 3rd Qu.:4.000 ## Max. :1.0000 Max. :5.000 Max. :8.000 В статистике данные очень часто группируют в соответствии с тем или иным признаком, например, полом, социальным положением, стадией болезни, местом отбора проб и т.п. В R существует специальный класс векторов - факторы (factors), которые предназначены для хранения кодов соответствующих уровней номинальных признаков.Часто уровни факторов кодируют в виде чисел. Если что факторные переменные закодированы при помощи чисел 0 и 1, то для корреткной работы нужно их преобразовать в факторы. например переменная df$vs указана как numeric. class(df$vs) ## [1] &quot;numeric&quot; Это может приводить к некоректной работе. Наример плот неправильно строит граф потому что неверно воспринимает тип переменной. plot(df$vs) Изменим тип переменной в факторы. df$vs &lt;- as.factor(df$vs) # теперь summary(df$vs) отображается корректно plot(df$vs) Или их можно переименовать сделав факторами в соответсвии с типом двигателя (V или S образный тип). df$vs &lt;- factor(df$vs, labels = c(&quot;V&quot;, &quot;S&quot;)) и по коробке передач (автоматическая или механическая). df$am &lt;- factor(df$am, labels = c(&quot;auto&quot;, &quot;manual&quot;)) summary(df$am) ## auto manual ## 19 13 plot(df$am) Также можно вставлять логические условия для обращения к некоторым элементам mean(df$mpg[df$cyl == 6 &amp; df$vs == &quot;V&quot;]) # те элементы у количество цилиндров = 6 и V-обтразный двигатель) ## [1] 20.56667 NA в переменной будет мешать посчитать некоторые статистики (например среднее значение) df$mpg[3] &lt;- NA head(df$mpg) ## [1] 21.0 21.0 NA 21.4 18.7 18.1 mean(df$mpg) ## [1] NA Можно пропускать отсутсвующие значения опцией na.rm (от not available и remove - удалить) mean(df$mpg, na.rm = TRUE) ## [1] 20.00323 Количество всех значений можно посчитать через length(df$mpg) # считаются значения включая NA ## [1] 32 Количество неотсутствующих значений можно посчитать вот так: sum(!is.na(df$mpg)) ## [1] 31 А количество отсутстствующих вот так: sum(is.na(df$mpg)) ## [1] 1 вернем значение на место df$mpg[3] &lt;- mtcars$mpg[3] Выяснить порядковые номера элементов, обладающих минимальным и максимальным значениями. which.min(df$mpg) ## [1] 15 which.max(df$mpg) ## [1] 20 Не бойтесь использовать функции при индексации и в других функциях: rownames(df)[which.min(df$mpg)] ## [1] &quot;Cadillac Fleetwood&quot; Описательные статистики можно также выполнять функцией aggregate() aggregate(x = df$mpg, by = list(df$vs), FUN = mean) # лист группирующих переменных ## Group.1 x ## 1 V 16.61667 ## 2 S 24.55714 aggregate(hp ~ vs, df, mean) # упрощенная запись ## vs hp ## 1 V 189.72222 ## 2 S 91.35714 aggregate(hp ~ vs + am, df, mean) # Можно разбивать по нескольким группам. ## vs am hp ## 1 V auto 194.16667 ## 2 S auto 102.14286 ## 3 V manual 180.83333 ## 4 S manual 80.57143 А также функцией tapply(). Эта функция относится к “apply-семейству” R-функций. Эти функции позволяют выполнять математические вычисления над определенными элементами таблиц данных, матриц, или массивов (например, быстро вычислять среднее значение для каждого столбца или строки таблицы, и т.п.). tapply(X = df$mpg, INDEX = df$am, FUN = Modes) # считает моду топливной экономичности по факторам коробки передач ## $auto ## [1] 19.2 15.2 10.4 ## ## $manual ## [1] 21.0 30.4 Подсчет среднего топливной экономичности по факторам коробки передач и типу двигателя. tapply(X = df$mpg, INDEX = list(df$am, df$vs), FUN = mean) ## V S ## auto 15.05 20.74286 ## manual 19.75 28.37143 В параметр FUN можно вставлять пользовательские функции, например написаную вручную функцию для стандратных ошибок. SE &lt;- function(x) {sd(x)/sqrt(length(x))} Вставляем в FUN и все работает. tapply(X = df$disp, INDEX = df$am, FUN = SE) ## auto manual ## 25.27511 24.18603 2.2.2 Показатели вариации Показатели вариации дают очень важную характеристику процессам и явлениям. Они отражают устойчивость процессов и однородность явлений. Чем меньше показатель вариации, тем более процесс устойчивый, а значит, и более предсказуемый. Квантили - общий термин для порогового значения не выше которого (то есть равно или ниже) которого лежит указанная часть данных. Медиана делит распределение попалам. Квартили делят распределение на четверти, квинтили - на 5 частей, децили - на 10 частей и процентили - на 100. Например, первый квартиль (Q1) делит распределение так, что 25 процентов наблюдений лежат не выше него; следовательно, 1-й квартиль также является 25-м процентилем. Второй квартиль (Q2) представляет 50-й процентиль, а третий квартиль (Q3) представляет 75-й процентиль, потому что 75 процентов наблюдений лежат не выше него. quantile(df$mpg) ## 0% 25% 50% 75% 100% ## 10.400 15.425 19.200 22.800 33.900 При настройках, заданных по умолчанию, выполнение указанной команды приведет к расчету минимального (10.4) и максимального (33.9) значений, а также трех квартилей, т.е. значений, которые делят совокупность на четыре равные части - 15.4, 19.2 и 22.8. Межквартильный размах - это разница между 1-м и 3-м квартилями, т.е. между 25-м и 75-м процентилями. А разница между первым и третьим квартилями носит название интерквартильный размах (ИКР; англ. interquartile range). ИКР является робастным (выборосоустойчивый) аналогом дисперсии и может быть рассчитан в R при помощи функции IQR(): IQR(df$mpg) ## [1] 7.375 Функция quantile() позволяет рассчитать и другие квантили. Например, децили (т.е. значения, делящие совокупность на десять частей) можно получить следующим образом: quantile(df$mpg, p = seq(0, 1, 0.1)) # задан вектор чисел от 0 до 1 с шагом в 0.1 = 10 квартилей ## 0% 10% 20% 30% 40% 50% 60% 70% 80% 90% 100% ## 10.40 14.34 15.20 15.98 17.92 19.20 21.00 21.47 24.08 30.09 33.90 Межквартильный размах - это разница между 1-м и 3-м квартилями, т.е. между 25-м и 75-м процентилями. Разница между первым и третьим квартилями носит название интерквартильный размах. Наглядное отображение размаха вариации и межквартильного расстояния производят с помощью диаграммы «ящик с усами». boxplot(df$mpg) Для подсчета кооффициента вариации и ассиметрии существует пакет moments (функции kurtosis() и skewness()) install.packages(&quot;moments&quot;) library(moments) ## Warning: package &#39;moments&#39; was built under R version 3.5.2 Коэффициент вариации или эксцесс (Kurtosis) - (среднеквадратическое отклонение деленное на среднее и умноженное на 100%). Этот показатель, который отражает остроту вершины и толщину хвостов одномерного распределения. Коэффициент вариации близок к 3 если наблюдения подчиняются нормальному распределению. Если коэффициент вариации значительно отличается от 3, то гипотезу о том, что данные взяты из нормально распределенной генеральной совокупности, следует отвергнуть. (НАСКОЛЬКО БОЛЬШЕ?) (Синяя кривая – нормальное распределение (куртозис нормального распределения вне зависимости от математического ожидания и стандартного отклонения равен 3). Красная кривая – имеет положительный эксцесс/куртозис больше 3.) set.seed(42) # устанавливает seed (семечко) чтобы последующий псевдослучайный процесс можно было вопроизвести kurtosis(rnorm(1000)) ## [1] 3.134824 Коэффициент асимметрии - величина, характеризующая асимметрию распределения данной случайной величины. Положителен если правый хвост распределения длиннее левого. skewness(df$mpg, na.rm = TRUE)# считая пропущенные значения ## [1] 0.6404399 2.3 Частотный анализ для разных шкал измерений Если вчера было 2 градусов по Цельсию а сегодня 4 градуса, значит ли это что сегодня в два раза теплее? (Ответ станет понятен в процессе.) 2.3.1 Неметрические шкалы: наименований и ранговая. Доступны непараметрические методы статистики. В шкале наименований (номенальной) числа используются лишь как метки, для различения обьектов. Примеры: тип двигателя (V образный и S образный), пол, расса. Допустимые операции: проверка совпадания несовпадения (тождественность)(a==b,a!=b). Возможные описательные статистики: частота, мода. df$vs[1] == df$vs[2] # обе машины имеют V образный двиатель ## [1] TRUE df$vs[1] == df$vs[3] # а эти имеют разные типы двигателей ## [1] FALSE В порядковой шкале (или ранговой) объекты ранжированы, расположены в порядке увеличения или уменьшения значения параметра. Примеры: бальные оценки успеваемости (неудовлетворительно, удовлетворительно, хорошо, отлично). Допустимые операции: проверка тождественности (a==b,a!=b), сравнения (a&gt;b, a&lt;b). Упорядочим машины по параметру “Приятность названия машины Григорию” (где 1 самая приятная) df$like &lt;- c(16,15,6,5,13,12,27,27,27,27,27,27,14,17,3,10,11,18,9,25,24,7,23,22,26,2,1,9,8,19,20,21) Одинаково ли Григорию нравятся название машин “Merc 240D” и Merc 230? df[&quot;Merc 230&quot;, &quot;like&quot;] == df[&quot;Merc 240D&quot;, &quot;like&quot;] # да, одинаково ## [1] TRUE А какое название приятнее “Porsche 914-2” или “Chrysler Imperial”? df[&quot;Porsche 914-2&quot;, &quot;like&quot;] &lt; df[&quot;Chrysler Imperial&quot;, &quot;like&quot;] # &quot;Porsche 914-2&quot; имеет более высокий ранг. ## [1] TRUE Возможные описательные статистики: мода, медиана. Допустимые статистики: ранговые коэффициенты корреляции (r-Спирмана, r-Кендалла) 2.3.2 Метрические шкалы: интервальная и абсолютная. Доступные параметрические методы статистики. В шкале интервалов существенной характеристикой является разность меджу значеними оцениваемых параметров выраженная в единицах этой шкалы. Начало отсчета может быть установлено произвольно. Примеры: шкала Цельсия. Интервал между замерзанием и кипением воды разделен на 100 равных частей названых градусами. Допустимые операции: проверка тождественности (a==b,a!=b), сравнения (a&gt;b, a&lt;b), сложения/вычетания (a+b, a-b). Ответ на вопрос в начале: Так как действия умножения и деления недоступны для интервальной шкалы, то неправомерно говорить во сколько раз одна температура больше другой. Возможные описательные статистики: мода, медиана, среднее арефметическое, стандартное отклонение. Допустимые статистики: критерий согласия Пирсона, R — множественный коэффициент корреляции, все известные операции с натуральными числами. Шкала отношений (абсолютная шкала) - это шкала интервалов у которой определено нулевой элемент - начало отсчета, а также размер едениц измерения. Примеры: длинна, стоимость, возраст. Допустимые операции: проверка тождественности (a==b,a!=b), сравнения (a&gt;b, a&lt;b), сложения/вычетания (a+b, a-b), умножения и деления (a*b, a/b). Возможные описательные статистики: мода, медиана, среднее арефметическое, дисперсия, стандартное отклонение, коэффициент вариации, геометрическое среднее (перемножаем числа и делим на их колличество). Допустимые статистики: критерий согласия Пирсона, R — множественный коэффициент корреляции, все известные операции с натуральными числами. Как правило, для переменных, относящихся к метрической (интервальной) шкале и подчиняющихся нормальному распределению, в качестве основной характеристики используют среднее значение, а в качестве меры разброса – стандартное отклонение или стандартную ошибку. Для порядковых или интервальных переменных, не подчиняющихся нормальному распределению, соответственно медиану или первый и третий квартили. Для переменных, относящихся к номинальной шкале, нельзя дать других значимых характеристиккроме моды. Оффтоп: Матрица диаграмм рассеянья может пригодиться чтобы быстро взглянуть на данные. pairs(mtcars[1:4]) 2.4 Построение таблиц сопряженности. Таблицы сопряжённости (contigency tables) — это удобный способ изображения категориальных переменных и исследования зависимостей между ними. Таблица сопряжённости представляет собой таблицу, ячейки которой индексируются градациями участвующих факторов, а числовое значение ячейки — количество наблюдений с данными градациями факторов. Для чего создаются таблицы сопряженности? Показывают совместное распределение переменных в номинальной и порядковой шкале Проверка значимых различий между наблюдаемыми и ожидаемыми частотами Выявляют наличие (отсутствие) взаимосвязи между переменными При анализе таблиц сопряженности выявляются статистические закономерности, но не причинно-следственные. О.Генри: «Почему дует ветер? – Потому что деревья качаются». Характер отношений между двумя переменными наглядно можно представить разными способами: В случае измерения признаков в номинальной или порядковой шкале возможные комбинации значений обеих переменных упорядочиваются в форме таблицы сопряженности, при этом значения одной переменной образуют строки, а значения другой — столбцы таблицы. После этого определяется частота появления всех возможных комбинаций обоих признаков в собранных данных и значение ее заносится в ячейки, стоящие на пересечении соответствующих строк и столбцов. Для количественных данных, а также порядковых переменных с очень большим числом вариаций исходные значения предварительно группируются, соседние значения объединяются в небольшое число интервалов. Построить таблицу сопряжённости можно с помощью функции table(). В качестве аргументов ей нужно передать факторы, на основе которых будет строиться таблица сопряжённости: # таблица сопряженности для выборки имеющей распределение Пуассона (n=100, λ = 5) table(rpois(100,5)) ## ## 0 1 2 3 4 5 6 7 8 9 10 11 ## 2 2 8 19 15 16 18 12 3 3 1 1 R использует «честное» представление для трёх- и более мерных таблиц сопряжённости, то есть каждый фактор получает по своему измерению. Однако, это не очень удобно при выводе подобных таблиц на печать или сравнении с таблицами в литературе. Традиционно для этого используются «плоские» таблицы сопряжённости, когда все факторы, кроме одного, объединяются в один «многомерный» фактор и именно градации такого фактора используются при построении таблицы сопряжённости. Построить плоскую таблицу сопряжённости можно с помощью функцией ftable(): table(Titanic) ## Titanic ## 0 1 3 4 5 11 13 14 17 20 35 57 75 76 80 89 118 140 154 192 ## 8 1 1 1 1 1 3 2 1 1 1 1 1 1 1 1 1 1 1 1 ## 387 670 ## 1 1 # Плоская таблица сопряженности для таблицы титаника a &lt;- ftable(Titanic, row.vars = 1:3) # графическое изображение таблицы сопряженности plot(Titanic, main = &quot;Survival on the Titanic&quot;, color = TRUE) # mosaicplot Опция row.vars позволяет указать номера переменных в наборе данных, которые следует объединить в один единый фактор, градации которого и будут индексировать строки таблицы сопряжённости. Опция col.vars проделывает то же самое, но для столбцов таблицы. Функцию table() можно использовать и для других целей. Например подсчёта частот. Также можно считать пропуски: d &lt;- factor(rep(c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;), 10), levels=c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;)) is.na(d) &lt;- 3:4 # делаем пару значений NA table(factor(d, exclude = NULL)) # exclude = NULL устанавливает NA как дополнительный фактор ## ## A B C &lt;NA&gt; ## 9 10 9 2 Задание создать такую таблицу сопряженности: # таблицу сопряженности в дата фрейме gip &lt;- data.frame(c(40, 32, 72), c(30, 48, 78), c(70,80, 150)) rownames(gip) &lt;- c(&quot;Курящие&quot;,&quot;Не курящие&quot;, &quot;Всего&quot;) colnames(gip) &lt;- c(&quot;С гипертонией&quot;,&quot;Без гипертонии&quot;, &quot;Всего&quot;) Используем датасет который предложил Иван Иванчей в курсе по R https://stepik.org/course/129/syllabus npersons - сколько человек в планируемом проекте years_in_uni сколько лет провел в университете руководитель проекта oldest_age - самый старый сортудник field - облать исследования status - поддержана ли заявка df &lt;- read.csv(&quot;https://stepic.org/media/attachments/lesson/11502/grants.csv&quot;) df$status &lt;- factor(df$status, labels = c(&quot;Не поддержан&quot;,&quot;Поддержан&quot;)) df &lt;- read.csv(&quot;https://stepic.org/media/attachments/lesson/11502/grants.csv&quot;) df$status &lt;- factor(df$status, labels = c(&quot;Не поддержан&quot;,&quot;Поддержан&quot;)) table.status &lt;- table(df$status) table.field &lt;- table(df$status, df$field) dim(table.status) # посмотреть размерность таблицы ## [1] 2 dim(table.field) ## [1] 2 5 prop.table(table.field) # пропорции или процены от общего числа ## ## beh_cog bio chem physics soc ## Не поддержан 0.07042254 0.33309859 0.04225352 0.04929577 0.03098592 ## Поддержан 0.04577465 0.30422535 0.04647887 0.05492958 0.02253521 prop.table(table.field, 1) # 100% - сумма по строке ## ## beh_cog bio chem physics soc ## Не поддержан 0.13386881 0.63319946 0.08032129 0.09370817 0.05890228 ## Поддержан 0.09658247 0.64190193 0.09806835 0.11589896 0.04754829 prop.table(table.field, 2) # 100% - сумма по столбцу ## ## beh_cog bio chem physics soc ## Не поддержан 0.6060606 0.5226519 0.4761905 0.4729730 0.5789474 ## Поддержан 0.3939394 0.4773481 0.5238095 0.5270270 0.4210526 Визуализация barplot(table.field, legend.text = TRUE, args.legend = list(x = &quot;topright&quot;), beside = TRUE) mosaicplot(table.field) 3-х мерная таблица table.years &lt;- table(Years = df$years_in_uni, field = df$field, status = df$status) dim(table.years) ## [1] 3 5 2 table.years ## , , status = Не поддержан ## ## field ## Years beh_cog bio chem physics soc ## &lt; 5 57 198 31 20 22 ## &gt; 10 29 144 28 47 16 ## 5-10 14 131 1 3 6 ## ## , , status = Поддержан ## ## field ## Years beh_cog bio chem physics soc ## &lt; 5 27 180 41 22 14 ## &gt; 10 30 155 19 54 15 ## 5-10 8 97 6 2 3 Домашнее задание: Выполнить 5.12 “Описательная статистика” https://pozdniakov.github.io/stats/tasks.html#task_desc Понять как работает table (посмотрите хелп) "],
["kriterii.html", "3 Критерии 3.1 Темы занятия 3.2 Хи квадрат 3.3 Точный тест Фишера 3.4 Проверка на нормальность 3.5 Критерий Стьюдента (t-test) 3.6 Критерий U-Манна-Уитни и Вилкоксона 3.7 Выбор критерия:", " 3 Критерии В память о погибшем коде. press F Делайте бекапы. Цените ваше время и силы. 3.1 Темы занятия Хи-квадрат Пирсона. Точный критерий Фишера. Проверка на нормальность и гомогенность дисперсий. (Графические методы, Вероятностная бумага, Критерии Шапиро–Уилка и Колмогорова–Смирнова.) Критерий Стьюдента (t.test). Критерий U-Манна-Уитни + Вилкоксон. Нам понадобятся: install.packages(&quot;ggplot2&quot;) install.packages(&quot;car&quot;) install.packages(&quot;nortest&quot;) Используем датасет который предложил Иван Иванчей в моем любимом курсе по R https://stepik.org/course/129/syllabus npersons - сколько человек в планируемом проекте years_in_uni сколько лет провел в университете руководитель проекта oldest_age - самый старый сортудник field - облать исследования status - поддержана ли заявка df &lt;- read.csv(&quot;https://stepic.org/media/attachments/lesson/11502/grants.csv&quot;) df$status &lt;- factor(df$status, labels = c(&quot;Не поддержан&quot;,&quot;Поддержан&quot;)) table.status &lt;- table(df$status) table.field &lt;- table(df$status, df$field) table.field # поддержаные и неподдержаные заявки на грант в разных областях ## ## beh_cog bio chem physics soc ## Не поддержан 100 473 60 70 44 ## Поддержан 65 432 66 78 32 3.2 Хи квадрат Критерий χ2 (“хи-квадрат”, также “Критерий согласия Пирсона”) - непараметрический метод, который позволяет оценить значимость различий между фактическим (выявленным в результате исследования) количеством исходов или качественных характеристик выборки, попадающих в каждую категорию, и теоретическим количеством, которое можно ожидать в изучаемых группах при справедливости нулевой гипотезы о отсутствии между ними различий. 3.2.1 Требования Работает с категориальными переменными. На вход функции chisq.test() можно подать одномерную или двухмерную таблицу сопряженности. Использование возможно при n&gt;40 (в идеале n&gt;200). 3.2.2 Ограничения Ожидаемые частоты не должны быть очень малы, так как критерий хи-квадрат проверяет вероятности в каждой ячейке, то если ожидаемые частоты в ячейках становятся меньше 5 (есть мнение что 10), то эти вероятности нельзя оценить с достаточной точностью с помощью имеющихся частот. Критерий χ2 ошибается на выборках с низкочастотными (редкими) событиями. Решить эту проблему можно отбросив низкочастотные события, либо объединив их с другими событиями. Этот способ называется коррекцией Йетса (Yates’ correction). 3.2.3 Пример использования chisq.test(table.status) ## ## Chi-squared test for given probabilities ## ## data: table.status ## X-squared = 3.8563, df = 1, p-value = 0.04956 chi &lt;- chisq.test(table.status) chi$exp # ожидаемые значения (если бы поддержки заявок распределялись случайно и равномерно) ## Не поддержан Поддержан ## 710 710 chi$obs # наблюдаемые значения ## ## Не поддержан Поддержан ## 747 673 3.2.4 Интерпритация Нулевая гипотиза о равномерном распределении вероятностей поддержаных и неподдержаных грантов отвергается. Вероятность не получить поддержку заявки чуть выше. Посмотрим как обстоит дело с поддержкой заявок по разным областям науки. Отхиквадратим двухмерную таблицу сопряженности. chisq.test(table.field) ## ## Pearson&#39;s Chi-squared test ## ## data: table.field ## X-squared = 8.0601, df = 4, p-value = 0.0894 Как можно видеть распределение поддержки заявок по разным областям различается на уровне тенденции, но гипотзу о том, что различий в поддержке заявок между областями нет мы отвернуть не можем. 3.2.5 Визуализация barplot(table.field, legend.text = TRUE, args.legend = list(x = &quot;topright&quot;), beside = TRUE) mosaicplot(table.field) Опасная опасность! Не используйте столбчатые диаграммы (barplot) для визуализации средних значений. Такие графики могут вводить в заблуждения. В них подразумевается нулевой уровень что не имеет отношения к средним значениям. Графики Barplot используются для счетных данных. 3.2.6 Задание: При помощи точного критерия согласия Пирсона проверьте гипотезу о различии в поддержке заявок (status) в зависимости от колличества лет, проведенных в университете руководителем проекта (years_in_uni). Какой p-уровень значимости? Ответ 0.0787 3.3 Точный тест Фишера Точный тест Фишера используется в анализе категориальных данных. Исследование значимости взаимосвязи между двумя переменными в факторной таблице размерности 2 x 2 для выборок маленьких размеров. Не путать с критерием Фишера (который сравнивает дисперсии двух независимых выборок.) Критерий основан на переборе всех возможных вариантов заполнения таблицы сопряженности при имеющейся численности групп. 3.3.1 Когда применяют? При небольшом числе наблюдений. Но в наши дни необязательно - у нас есть мощь R чтобы проводить его на большом колличестве наблюдений. 3.3.2 Требования Принимает на вход двухмерную таблицу сопряженности. 3.3.3 Пример использования fisher.test(table.field) ## ## Fisher&#39;s Exact Test for Count Data ## ## data: table.field ## p-value = 0.08921 ## alternative hypothesis: two.sided 3.3.4 Задание: При помощи точного критерия Фишера проверьте гипотезу о взаимосвязи типа коробки передач (am) и типа двигателя (vs) в данных mtcars. Какой p-уровень значимости? Ответ 0.4727 3.4 Проверка на нормальность Величины, имеющие нормальное распределение, в реальных экспериментах возникают совершенно естественным образом, При измерении любой характеристики всегда имеется ошибка измерения. Если предполагать, что ошибка прибора имеет нормальное распределение, то среднее отвечает за систематическую ошибку, а дисперсия — за величину случайной ошибки. График плотности вероятности нормального распределения и процент попадания случайной величины на отрезки, равные среднеквадратическому отклонению. Некоторые критерии предпологают их использование только если выборка имеет нормальное распределение. Если это не так, то выводы, полученные на основе этих критериев, будут ошибочными. Что делать, если заранее известно, что выборки имеют другое распределение отличающееся от нормального? В таких случаях используются непараметрические критерии, т. е. свободные от предположения какой-либо параметрической модели данных. К сожалению, эти критерии оперируют гораздо меньшим «объёмом информации» и не смогут заметить такие тонкие различия, которые были бы обнаружены при использовании параметрических критериев, опирающихся на предположеие о нормальности распределения. Как понять нормально ли распределены данные? Можно оценить на глаз, построив гисторамму или график квантилей: library(&quot;car&quot;) ## Warning: package &#39;car&#39; was built under R version 3.5.3 ## Loading required package: carData ## Warning: package &#39;carData&#39; was built under R version 3.5.2 hist(rnorm(100)) # гистограмма нормального распределения выглядит примерно так qqnorm(rnorm(100)) # встроенная функция для построения графика квантилей qqPlot(rnorm(100)) # значения нормального распределения сильно не выходят за пунктирную линию и выстраиваются вдоль центральной линии ## [1] 97 37 Вероятностная бумага (диаграмма Вейбула) – это специальный бланк, разлинованный таким образом, что кумулятивная функция нормального закона на нем приближается к прямой линии. Если график на диаграмме представлен набором точек, которые рассеянны около прямой линии, то это позволяет предположить, что генеральная совокупность, из которой взята выборка, подчиняется нормальному закону распределения случайной величины. Если точки аппроксимируются в кривую линию, то распределение параметра X отличается от нормального и при этом можно оценить кривизну и асимметрию функции плотности распределения. Но прикидки на глаз обычно не столь хороши как статистические тесты, поэтому разберем некоторые из них. Но сперва познакомимся с датасетом на котором дальше мы будем разбирать примеры - iris. Он описывает длинну и ширину лепестка и чашелистика 50 цветков ириса. df1 &lt;- subset(iris, Species != &quot;setosa&quot;) # возьмем 2 вида цветков потому что для t-test нужнен групирующий фактор с 2 уровенями. str(df1) ## &#39;data.frame&#39;: 100 obs. of 5 variables: ## $ Sepal.Length: num 7 6.4 6.9 5.5 6.5 5.7 6.3 4.9 6.6 5.2 ... ## $ Sepal.Width : num 3.2 3.2 3.1 2.3 2.8 2.8 3.3 2.4 2.9 2.7 ... ## $ Petal.Length: num 4.7 4.5 4.9 4 4.6 4.5 4.7 3.3 4.6 3.9 ... ## $ Petal.Width : num 1.4 1.5 1.5 1.3 1.5 1.3 1.6 1 1.3 1.4 ... ## $ Species : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 2 2 2 2 2 2 2 2 2 2 ... Посмотрим на форму распределения длинны чашелистика в зависимости от вида ириса: library(&quot;ggplot2&quot;) ## Warning: package &#39;ggplot2&#39; was built under R version 3.5.3 hist(df1$Sepal.Length) # схематично, сбоку ggplot(df1, aes(Sepal.Length, fill = Species))+ geom_density(alpha = 0.5) # информативно, сбоку ggplot(df1, aes(Species, Sepal.Length))+ geom_boxplot() # можно сказачать что взгляд сверху 3.4.1 Критерии Шапиро–Уилка Один из тестов которые проверяют происходит ли анаизируемая выборка из генеральной совокупности имеющей нормальное распределение является Критерии Шапиро–Уилка. Если получаемая при помощи того или иного теста вероятность ошибки Р оказывается меньше некоторого заранее принятого уровня значимости (например, 0.05), нулевая гипотеза отклоняется и мы отвергаем гипотезу о нормальности распределения. shapiro.test(df1$Sepal.Length) # p &gt; 0.05 - нулевая гипотиза не отвергается, предпологаем что параметр распределен нормально. ## ## Shapiro-Wilk normality test ## ## data: df1$Sepal.Length ## W = 0.98054, p-value = 0.1464 Можно провести проверку на нормальность переменной в разных группах с помощью функции by(). Проверка на нормальность переменной Sepal.Length в трех разных группах в соответствии с переменной Species: by(iris$Sepal.Length, INDICES = iris$Species, shapiro.test) ## iris$Species: setosa ## ## Shapiro-Wilk normality test ## ## data: dd[x, ] ## W = 0.9777, p-value = 0.4595 ## ## ------------------------------------------------------------ ## iris$Species: versicolor ## ## Shapiro-Wilk normality test ## ## data: dd[x, ] ## W = 0.97784, p-value = 0.4647 ## ## ------------------------------------------------------------ ## iris$Species: virginica ## ## Shapiro-Wilk normality test ## ## data: dd[x, ] ## W = 0.97118, p-value = 0.2583 3.4.2 Критерий Колмогорова–Смирнова Поскольку стандартный Критерий Колмагорова-Смирнова может проверять гипотизы соответствия выборки некоторому заданному закону распределения, при использовании его нужно указать с каким распределением проводится сравнение, среднее значение и стандартное отклоенение. mean(df1$Sepal.Length) # среднее для выборки ## [1] 6.262 sd(df1$Sepal.Length) # стандартное отклонение ## [1] 0.6628344 ks.test(df1$Sepal.Length, &quot;pnorm&quot;, mean = 6.262, sd = 0.6628344) # не уверен что сюда нужно ставить реальные значния а не &quot;теоретические&quot;. Пожалуйста, поправте меня. ## Warning in ks.test(df1$Sepal.Length, &quot;pnorm&quot;, mean = 6.262, sd = 0.6628344): ## ties should not be present for the Kolmogorov-Smirnov test ## ## One-sample Kolmogorov-Smirnov test ## ## data: df1$Sepal.Length ## D = 0.067538, p-value = 0.7517 ## alternative hypothesis: two-sided Но лучше, если нам не известны мат. ожидание и дисперсия (а так оно обычно и есть), использовать модификацию этого критерия - Критерий Лиллиефорса который реализован в пакете nortest. library(&quot;nortest&quot;) ## Warning: package &#39;nortest&#39; was built under R version 3.5.2 lillie.test(df1$Sepal.Length) ## ## Lilliefors (Kolmogorov-Smirnov) normality test ## ## data: df1$Sepal.Length ## D = 0.067538, p-value = 0.3169 3.4.3 Проверка однородности (гомогенности) дисперсий. Для проверки однородности дисперсий существует например Тест Бартлетта. bartlett.test(Sepal.Length ~ Species, df1) ## ## Bartlett test of homogeneity of variances ## ## data: Sepal.Length by Species ## Bartlett&#39;s K-squared = 2.0949, df = 1, p-value = 0.1478 Как видно по p-value дисперсии этих групп однородны. При выявлении существенной неоднородности дисперсии возможны два решения: определенное преобразование исходных данных (например, логарифмирование) или использование моделей, допускающих неоднородность дисперсии. 3.5 Критерий Стьюдента (t-test) t-критерий Стьюдента — общее название для класса методов статистической проверки гипотез (статистических критериев), основанных на распределении Стьюдента. Наиболее частые случаи применения t-критерия связаны с проверкой равенства средних значений в двух выборках. В одном случае его применяют для проверки гипотезы о равенстве генеральных средних двух независимых, несвязанных выборок (так называемый двухвыборочный t-критерий). В этом случае есть контрольная группа и экспериментальная (опытная) группа, количество испытуемых в группах может быть различно. Во втором случае, когда одна и та же группа объектов порождает числовой материал для проверки гипотез о средних, используется так называемый парный t-критерий. Выборки при этом называют зависимыми, связанными. 3.5.1 Метод реализации Критерий позволяет найти вероятность того, что оба средних значения в выборке относятся к одной и той же совокупности. Данный критерий наиболее часто используется для проверки гипотезы: «Средние двух выборок относятся к одной и той же совокупности». T-статистика строится обычно по следующему общему принципу: в числителе случайная величина с нулевым математическим ожиданием (при выполнении нулевой гипотезы), а в знаменателе — выборочное стандартное отклонение этой случайной величины, получаемое как квадратный корень из несмещённой оценки дисперсии. 3.5.2 Требования Для применения данного критерия необходимо, чтобы исходные данные имели нормальное распределение. В случае применения двухвыборочного критерия для независимых выборок также необходимо соблюдение условия равенства дисперсий. 3.5.3 Ограничения Чувствителен к выборосам. Буквально пара сильных выбросов может убить весь p-value. 3.5.4 Пример использования Для Критерия Стьюдента с независимыми выборками на вход необходимо подать две переменные, одна колличественая а другая номенальная представленная в качестве фактора из двух уровенй. t.test(Sepal.Length ~ Species, df1) ## ## Welch Two Sample t-test ## ## data: Sepal.Length by Species ## t = -5.6292, df = 94.025, p-value = 1.866e-07 ## alternative hypothesis: true difference in means is not equal to 0 ## 95 percent confidence interval: ## -0.8819731 -0.4220269 ## sample estimates: ## mean in group versicolor mean in group virginica ## 5.936 6.588 1.866e-07 == 0.0000001866 # e-07 = умножение на 10 в минус 7 степени (добавили 6 нулей после запятой) ## [1] TRUE 3.5.5 Интерпритация: Так как p-уровень меньше 0.05 то мы можем отклонить нулевую гипотизу о равенстве средних. 3.5.6 Дополнительные параметры Тип альтернативной гипотизы - односторонний или двухсторонний (alternative). Тест для зависимых или независимых выборок (paired). Выполняется ли условие гомогенности дисперсий (var.equal = TRUE); Или t-критерий в модификации Уэлча (Welch), свободный от этого предположения (var.equal = FALSE, по умолчанию). Проведем одновыборочный t.test чтобы проверить сравнить “теоретическое среднее” с наблюдаемым. t.test(df1$Sepal.Length, mu = 8) # проверим равняется ли среднее в генеральной совокупности 8? ## ## One Sample t-test ## ## data: df1$Sepal.Length ## t = -26.221, df = 99, p-value &lt; 2.2e-16 ## alternative hypothesis: true mean is not equal to 8 ## 95 percent confidence interval: ## 6.130479 6.393521 ## sample estimates: ## mean of x ## 6.262 3.5.7 Задание: C помощью Критерия Стьюдента проверьте на данных df1 гипотизу что в генеральной совокупности средняя длинна чашелистика равняется 6.2. Какой p-value? Ответ 0.3519 Критерий стьюдента можно применять для зависимых переменных. Для этого эти переменные должны быть колличественные и подаваться на вход как два отдельных вектора значений. Проверим что длинна и ширина чашелистика не равны. t.test(df1$Sepal.Length, df1$Sepal.Width, paired = TRUE) ## ## Paired t-test ## ## data: df1$Sepal.Length and df1$Sepal.Width ## t = 61.307, df = 99, p-value &lt; 2.2e-16 ## alternative hypothesis: true difference in means is not equal to 0 ## 95 percent confidence interval: ## 3.280282 3.499718 ## sample estimates: ## mean of the differences ## 3.39 3.5.8 Визуализация. Чтобы отобразить на графике сравнение двух средних с доверительными интервалами можно применить stat_summary() добавленную к ggplot. Различия в средних и доверительных интервалах длины лепестка между двумя видами ирисов: ggplot(df1, aes(Species, Sepal.Length))+ stat_summary(fun.data = mean_cl_normal, geom = &quot;pointrange&quot;, size = 2)# mean_cl_normal встроенная в ggplot функция подсчета среднего. 3.6 Критерий U-Манна-Уитни и Вилкоксона U-критерий Манна — Уитни — Уилкоксона (англ. Mann–Whitney U-test) — статистический критерий, используемый для оценки различий между двумя независимыми выборками по уровню какого-либо признака, измеренного количественно. Позволяет выявлять различия в значении параметра между малыми выборками. Критерий переводит все данные в ранговую шкалу (уходит от реальных значений признака и ранжирует все показатели от первого до последнего наблюдения) а затем считает какой средний ранг оказался в первой группе, а какой во второй. Создатели системы R под названием “критерий Уилкоксона” (или “тест Уилкоксона”) объединяют как собственно метод, предложенный Фрэнком Уилкоксоном (Frank Wilcoxon) в 1945 г., так и опубликованный несколько позднее (1947 г.) метод Манна-Уитни. Первый из этих методов обычно используется для сравнения двух связных выборок, тогда как второй предназначен для сравнения двух независимых выборок. 3.6.1 Метод реализации Для двух независимых выборок все имеющиеся значения ранжируют, игнорируя их знак; Ранги значений, принадлежащих к первой группе, суммируют, получая величину W; Полученное W сравнивают со значением, которое можно было бы ожидать при верной нулевой гипотезе и имеющемся числе степеней свободы; альтернативный подход - находят вероятность случайным образом получить значение W, равное или превышающее наблюдаемое значение (при условии истинности нулевой гипотезы). Сравнение зависимых выборок выборок при помощи критерия Уилкоксона происходит сходно с тем, как это делается при помощи парного критерия Стьюдента. В частности, находят разницу между всеми имеющимися парными выборочными наблюдениями с целью проверить нулевую гипотезу о том, что медиана полученных разностей равна нулю (либо какому-либо другому, отличному от нуля значению). 3.6.2 Когда используют? Если не выполняется одно из требований для критерия Стьюдента, не очень много данных или не очень нормальное распределение. Непараметрические аналог t.test. Гораздо менее чувствителен к выбросам чем критерий Стьюдента. 3.6.3 Ограничения В каждой из выборок должно быть не менее 3 значений признака. Допускается, чтобы в одной выборке было два значения, но во второй тогда не менее пяти. В выборочных данных не должно быть совпадающих значений (все числа — разные) или таких совпадений должно быть очень мало (до 10). В каждой выборке должно быть не более 60 наблюдений; 3.6.4 Пример использования wilcox.test(df1$Petal.Length ~ Species, df1) ## ## Wilcoxon rank sum test with continuity correction ## ## data: df1$Petal.Length by Species ## W = 44.5, p-value &lt; 2.2e-16 ## alternative hypothesis: true location shift is not equal to 0 3.6.5 Интерпритация Длинны лепестков между видами ирисов статистически значимо различаются. Также как и для t.test() существует wilcox.test() для зависимых переменных. Форма записи такая же как в критерии Стьюдента. wilcox.test(df1$Petal.Length, df1$Petal.Width, paired = TRUE) ## ## Wilcoxon signed rank test with continuity correction ## ## data: df1$Petal.Length and df1$Petal.Width ## V = 5050, p-value &lt; 2.2e-16 ## alternative hypothesis: true location shift is not equal to 0 wilcox.test(df1$Petal.Length, df1$Petal.Width, conf.int = TRUE) # оценка различия в сдвиге между двумя выборками и доверительный интервал для него ## ## Wilcoxon rank sum test with continuity correction ## ## data: df1$Petal.Length and df1$Petal.Width ## W = 10000, p-value &lt; 2.2e-16 ## alternative hypothesis: true location shift is not equal to 0 ## 95 percent confidence interval: ## 3.000057 3.399983 ## sample estimates: ## difference in location ## 3.200054 Как видим эти характеристики лепестка не равны. 3.6.6 Визуализация Чтобы отобразить на графике сравнение двух средних с доверительными интервалами можно применить stat_summary() добавленную к ggplot. Различия в средних и доверительных интервалах длины лепестка между двумя видами ирисов: ggplot(df1, aes(Species, Petal.Length))+ geom_boxplot() 3.6.7 Задание: Обьясните, почему мы по разному визуализируем данные Критерия Стьюдента и данные Критерия Вилкоксона-Манна-Утни? 3.7 Выбор критерия: "]
]
